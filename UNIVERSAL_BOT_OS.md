# ü§ñ Universal Bot OS - Multi-Tenant Architecture

**–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∞ AI-—Ñ—Ä–µ–Ω–¥–ª—ñ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è 100+ –±–æ—Ç–∞–º–∏**

## üìã TODO –ü–ª–∞–Ω (17 –∑–∞–¥–∞—á)

### ‚úÖ –§–∞–∑–∞ 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç (3 –∑–∞–¥–∞—á—ñ)
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É - –º–æ–¥—É–ª—å–Ω–∞ FastAPI –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- [ ] SQL —Å—Ö–µ–º–∞ - –º–æ–¥–µ–ª—ñ SQLAlchemy
- [ ] –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è - core/config.py, database.py, security.py

### üîÑ –§–∞–∑–∞ 2: –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑ n8n (3 –∑–∞–¥–∞—á—ñ)
- [ ] –ê–Ω–∞–ª—ñ–∑ n8n - –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ JSON –µ–∫—Å–ø–æ—Ä—Ç (60 –Ω–æ–¥)
- [ ] –í–∏—Ç—è–≥ –ª–æ–≥—ñ–∫–∏ - –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É —Ç–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
- [ ] –°–µ—Ä–≤—ñ—Å–∏ - —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —á–∏—Å—Ç—É –ª–æ–≥—ñ–∫—É –≤ app/services/

### üöÄ –§–∞–∑–∞ 3: Core —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª (3 –∑–∞–¥–∞—á—ñ)
- [ ] –ê–¥–∞–ø—Ç–µ—Ä–∏ - Telegram adapter + omnichannel —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] API endpoints - –≤–µ–±—Ö—É–∫–∏, Mini Apps, SEO
- [ ] i18n - —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤ (5+ –º–æ–≤)

### üß† –§–∞–∑–∞ 4: AI —Ç–∞ –¥–∞–Ω—ñ (2 –∑–∞–¥–∞—á—ñ)
- [ ] AI —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è - OpenAI/Anthropic –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –º–æ–≤–∏
- [ ] –ú—ñ–≥—Ä–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö - —Å–∫—Ä–∏–ø—Ç–∏ –∑ Google Sheets –¥–æ PostgreSQL

### üê≥ –§–∞–∑–∞ 5: –î–µ–ø–ª–æ–π (3 –∑–∞–¥–∞—á—ñ)
- [ ] Docker & Railway - Dockerfile, docker-compose.yml, railway.json
- [ ] –î–µ–ø–ª–æ–π - –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Railway –∑ PostgreSQL + Redis
- [ ] –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ - health checks, –ª–æ–≥—É–≤–∞–Ω–Ω—è, error tracking

### üë®‚Äçüíº –§–∞–∑–∞ 6: –ê–¥–º—ñ–Ω–∫–∞ (3 –∑–∞–¥–∞—á—ñ)
- [ ] –ê–¥–º—ñ–Ω–∫–∞ API - CRUD –¥–ª—è –±–æ—Ç—ñ–≤, –ø—Ä–æ–º–ø—Ç—ñ–≤, –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π
- [ ] –ê–¥–º—ñ–Ω–∫–∞ UI - –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è
- [ ] –ê–¥–º—ñ–Ω–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –¥–∞—à–±–æ—Ä–¥ –∑ –º–µ—Ç—Ä–∏–∫–∞–º–∏

---

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É
```
universal-bot-os/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # FastAPI app
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ api/                    # API endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhooks.py     # Telegram webhooks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mini_apps.py    # Mini Apps endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seo.py          # SEO endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.py        # Admin API
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/                   # Core infrastructure
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py           # Settings (Pydantic)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py         # DB connection
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py         # Auth, JWT
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py     # FastAPI dependencies
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/                 # SQLAlchemy models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py              # Bot model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py             # User model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message.py          # Message model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ translation.py     # Translation model
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ business_data.py   # Business data models
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                # Pydantic schemas (API)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ message.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/               # Business logic (—á–∏—Å—Ç–∞ –ª–æ–≥—ñ–∫–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot_service.py      # Bot management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py     # User management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message_service.py  # Message handling
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py       # AI integration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ translation_service.py  # i18n
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ adapters/               # Platform adapters
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py             # Base adapter interface
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram.py         # Telegram adapter
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ web.py              # Web chat adapter (–º–∞–π–±—É—Ç–Ω—î)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/                  # Utilities
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ helpers.py
‚îÇ
‚îú‚îÄ‚îÄ migrations/                 # Alembic migrations
‚îú‚îÄ‚îÄ scripts/                    # Utility scripts
‚îÇ   ‚îî‚îÄ‚îÄ migrate_from_sheets.py  # Google Sheets migration
‚îÇ
‚îú‚îÄ‚îÄ tests/                      # Tests
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_api/
‚îÇ   ‚îú‚îÄ‚îÄ test_services/
‚îÇ   ‚îî‚îÄ‚îÄ test_adapters/
‚îÇ
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ railway.json
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ pyproject.toml
‚îî‚îÄ‚îÄ README.md
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π —Å—Ç–µ–∫
- **Backend:** Python 3.11+, FastAPI
- **Database:** PostgreSQL (SQLAlchemy/SQLModel)
- **Cache:** Redis
- **Infrastructure:** Railway
- **AI:** OpenAI/Anthropic
- **Frontend (–º–∞–π–±—É—Ç–Ω—î):** Next.js –¥–ª—è –∞–¥–º—ñ–Ω–∫–∏

---

## üóÑÔ∏è SQL –°—Ö–µ–º–∞

### –û—Å–Ω–æ–≤–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ

#### `bots`
```sql
- id: UUID (PK)
- platform_type: VARCHAR (tg/web/whatsapp)
- token: VARCHAR (encrypted)
- name: VARCHAR
- config: JSONB (AI prompts, colors, keys, settings)
- default_lang: VARCHAR (uk/en/ru/pl/de)
- is_active: BOOLEAN
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### `users`
```sql
- id: UUID (PK)
- external_id: VARCHAR (telegram_id, etc.)
- platform: VARCHAR (telegram/web)
- bot_id: UUID (FK -> bots.id)
- language_code: VARCHAR (uk/en/ru/pl/de)
- balance: DECIMAL (10,2)
- metadata: JSONB (custom fields)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
- UNIQUE(bot_id, external_id, platform)
```

#### `messages`
```sql
- id: UUID (PK)
- user_id: UUID (FK -> users.id)
- bot_id: UUID (FK -> bots.id)
- role: VARCHAR (user/assistant/system)
- content: TEXT
- metadata: JSONB (message_id, reply_to, etc.)
- timestamp: TIMESTAMP
- INDEX(user_id, timestamp) –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É AI
```

#### `translations`
```sql
- id: UUID (PK)
- key: VARCHAR (message.welcome, button.start, etc.)
- lang: VARCHAR (uk/en/ru/pl/de)
- text: TEXT
- UNIQUE(key, lang)
```

#### `business_data` (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –Ω—ñ—à—ñ)
```sql
- id: UUID (PK)
- bot_id: UUID (FK -> bots.id)
- data_type: VARCHAR (wallet, partner, log, etc.)
- data: JSONB (flexible structure)
- created_at: TIMESTAMP
- INDEX(bot_id, data_type)
```

---

## üîë –ö–ª—é—á–æ–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏

### 1. Omnichannel Architecture
- **Base Adapter Interface:** –í—Å—ñ –∞–¥–∞–ø—Ç–µ—Ä–∏ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å —Å–ø—ñ–ª—å–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **Service Layer:** –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ –≤—ñ–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏
- **–î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ—ó –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏:** –¢—ñ–ª—å–∫–∏ –Ω–æ–≤–∏–π adapter, –±–µ–∑ –∑–º—ñ–Ω —É services/

### 2. Multi-Tenancy
- –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –º–∞—î `bot_id`
- –Ü–∑–æ–ª—è—Ü—ñ—è –¥–∞–Ω–∏—Ö –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î (WHERE bot_id = ?)
- Shared infrastructure, isolated data

### 3. i18n
- –í—Å—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ —Ä—è–¥–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ `translations`
- –ú–æ–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ `users.language_code`
- AI –ø—Ä–æ–º–ø—Ç–∏ –≤—Ä–∞—Ö–æ–≤—É—é—Ç—å –º–æ–≤—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### 4. AI-Friendly Code
- –ú–æ–¥—É–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –≤ –∫–æ–¥—ñ
- –ß—ñ—Ç–∫—ñ –Ω–∞–∑–≤–∏ —Ñ—É–Ω–∫—Ü—ñ–π/–∫–ª–∞—Å—ñ–≤
- Type hints —Å–∫—Ä—ñ–∑—å

---

## üìù –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

1. ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ TODO –ø–ª–∞–Ω (17 –∑–∞–¥–∞—á)
2. ‚è≥ –°—Ç–≤–æ—Ä—é—é –±–∞–∑–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç—É
3. ‚è≥ –°—Ç–≤–æ—Ä—é—é SQL –º–æ–¥–µ–ª—ñ
4. ‚è≥ –û—á—ñ–∫—É—é JSON –µ–∫—Å–ø–æ—Ä—Ç n8n –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É

**–ì–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏!** üöÄ

