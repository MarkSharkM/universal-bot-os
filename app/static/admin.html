<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Bot OS - Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <div>
                <h1>ü§ñ Universal Bot OS - Admin Panel</h1>
                <p>Multi-tenant bot management platform</p>
            </div>
            <div style="min-width: 300px;">
                <label
                    style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--text-secondary);">Selected
                    Bot:</label>
                <select id="global-bot-select" onchange="onGlobalBotChange()"
                    style="width: 100%; padding: 10px 16px; border: 1px solid var(--border); border-radius: var(--radius); font-size: 14px; background: white; cursor: pointer;">
                    <option value="">Loading...</option>
                </select>
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="showTab('bots', event)">Bots</button>
            <button class="tab" onclick="showTab('partners', event)">Partners</button>
            <button class="tab" onclick="showTab('database', event)">üóÑÔ∏è Database</button>
            <button class="tab" onclick="showTab('ai', event)">AI Config</button>
            <button class="tab" onclick="showTab('stats', event)">Statistics</button>
            <button class="tab" onclick="showTab('monitoring', event)">üìä Monitoring</button>
        </div>

        <!-- Bots Tab -->
        <div id="bots" class="tab-content active">
            <h2>Bot Management</h2>
            <div id="bots-message"></div>

            <button onclick="showCreateBotForm()" style="margin-bottom: 20px;">+ Create Bot</button>

            <div id="create-bot-form"
                style="display: none; background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3>Create New Bot</h3>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="bot-name" placeholder="Bot Name">
                </div>
                <div class="form-group">
                    <label>Platform</label>
                    <select id="bot-platform">
                        <option value="telegram">Telegram</option>
                        <option value="web">Web</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Token</label>
                    <input type="text" id="bot-token" placeholder="Bot Token">
                </div>
                <div class="form-group">
                    <label>Default Language</label>
                    <select id="bot-lang">
                        <option value="uk">Ukrainian</option>
                        <option value="en">English</option>
                        <option value="ru">Russian</option>
                    </select>
                </div>
                <button onclick="createBot()">Create</button>
                <button onclick="hideCreateBotForm()" style="background: #666; margin-left: 10px;">Cancel</button>
            </div>

            <table id="bots-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Platform</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="bots-tbody"></tbody>
            </table>
        </div>

        <!-- Partners Tab -->
        <div id="partners" class="tab-content">
            <h2>Partners Management</h2>
            <div id="partners-message"></div>

            <div class="form-group">
                <label>Select Bot</label>
                <select id="partners-bot-select" onchange="loadPartners()"
                    style="padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; cursor: pointer; transition: all 0.3s ease;"></select>
            </div>

            <button onclick="showCreatePartnerForm()"
                style="margin-bottom: 20px; font-size: 16px; padding: 14px 28px;">‚ú® + Add Partner</button>

            <div id="create-partner-form"
                style="display: none; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); padding: 30px; border-radius: 16px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                <h3>Add New Partner</h3>
                <div class="form-group"
                    style="background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 2px dashed #0284c7; box-shadow: 0 4px 12px rgba(2, 132, 199, 0.1);">
                    <label style="font-weight: 600; color: #0c4a6e; margin-bottom: 8px; display: block;">üìã Paste from
                        Google Sheets (optional)</label>
                    <textarea id="partner-paste-data" rows="3"
                        placeholder="Paste row from Google Sheets here (tab-separated) - will auto-parse:&#10;Boinkers	–ú–µ–º-–±–∞—Ç–ª–∏ –∑–∞ –∑—ñ—Ä–∫–∏ üí©üíé	üí©üíé Meme battles for stars	..."
                        style="width: 100%; padding: 8px; border: 1px solid #0284c7; border-radius: 4px; font-family: monospace; font-size: 12px; transition: background-color 0.3s ease, border-color 0.3s ease;"
                        onpaste="setTimeout(() => parsePastedData(), 100)"></textarea>
                    <button type="button" onclick="parsePastedData()"
                        style="background: #0284c7; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; margin-top: 8px; font-size: 12px;">Parse
                        & Fill Form</button>
                    <p style="font-size: 11px; color: #0369a1; margin-top: 8px; margin-bottom: 0;">Format: Bot Name |
                        Description (UK) | Description (EN) | Description (RU) | Description (DE) | Description (ES) |
                        Referral Link | RefParam | Commission | Category | Active | Duration | Verified | ... | ROI
                        Score</p>
                </div>

                <!-- Preview Card -->
                <div id="partner-preview-card"
                    style="display: none; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #22c55e; border-radius: 16px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 24px rgba(34, 197, 94, 0.2);">
                    <h4 style="margin-top: 0; color: #15803d; display: flex; align-items: center; gap: 8px;">
                        <span>‚úÖ</span> Preview - Review before adding
                    </h4>
                    <div id="partner-preview-content"
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 13px;">
                        <!-- Will be filled by JavaScript -->
                    </div>
                    <div id="partner-preview-warnings"
                        style="margin-top: 15px; padding: 10px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px; display: none;">
                        <strong style="color: #92400e;">‚ö†Ô∏è Warnings:</strong>
                        <ul id="partner-preview-warnings-list"
                            style="margin: 8px 0 0 0; padding-left: 20px; color: #78350f;"></ul>
                    </div>
                </div>

                <div class="form-group">
                    <label>Bot Name</label>
                    <input type="text" id="partner-name" placeholder="Partner Bot Name">
                </div>
                <div class="form-group">
                    <label>Description (UK)</label>
                    <textarea id="partner-description" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Description (EN)</label>
                    <textarea id="partner-description-en" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Description (RU)</label>
                    <textarea id="partner-description-ru" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Description (DE)</label>
                    <textarea id="partner-description-de" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Description (ES)</label>
                    <textarea id="partner-description-es" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Referral Link</label>
                    <input type="text" id="partner-link" placeholder="https://t.me/bot?start={TGR}">
                </div>
                <div class="form-group">
                    <label>Commission (%)</label>
                    <input type="number" id="partner-commission" step="0.1">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="partner-category">
                        <option value="NEW">NEW</option>
                        <option value="TOP">TOP</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Active</label>
                    <select id="partner-active">
                        <option value="Yes">Yes ‚úÖ</option>
                        <option value="No">No ‚ùå</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Verified</label>
                    <select id="partner-verified">
                        <option value="Yes">Yes ‚úÖ</option>
                        <option value="No">No ‚ùå</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ROI Score</label>
                    <input type="number" id="partner-roi" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label>Duration (days)</label>
                    <input type="number" id="partner-duration" placeholder="9999" min="0" step="1">
                    <p style="font-size: 11px; color: #666; margin-top: 4px;">How many days the partnership is valid</p>
                </div>
                <button onclick="createPartner()" style="font-size: 16px; padding: 14px 28px;">‚úÖ Add Partner</button>
                <button onclick="hideCreatePartnerForm()"
                    style="background: linear-gradient(135deg, #64748b 0%, #475569 100%); margin-left: 10px; font-size: 16px; padding: 14px 28px;">‚ùå
                    Cancel</button>
            </div>

            <div id="edit-partner-form"
                style="display: none; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); padding: 30px; border-radius: 16px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 2px solid #667eea;">
                <h3>Edit Partner</h3>
                <input type="hidden" id="edit-partner-id">
                <div class="form-group">
                    <label>Bot Name</label>
                    <input type="text" id="edit-partner-name" placeholder="Partner Bot Name">
                </div>
                <div class="form-group">
                    <label>Description (UK)</label>
                    <textarea id="edit-partner-description" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Description (EN)</label>
                    <textarea id="edit-partner-description-en" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Description (RU)</label>
                    <textarea id="edit-partner-description-ru" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Description (DE)</label>
                    <textarea id="edit-partner-description-de" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Description (ES)</label>
                    <textarea id="edit-partner-description-es" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Referral Link</label>
                    <input type="text" id="edit-partner-link" placeholder="https://t.me/bot?start={TGR}">
                </div>
                <div class="form-group">
                    <label>Commission (%)</label>
                    <input type="number" id="edit-partner-commission" step="0.1">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="edit-partner-category">
                        <option value="NEW">NEW</option>
                        <option value="TOP">TOP</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Active</label>
                    <select id="edit-partner-active">
                        <option value="Yes">Yes ‚úÖ</option>
                        <option value="No">No ‚ùå</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Verified</label>
                    <select id="edit-partner-verified">
                        <option value="Yes">Yes ‚úÖ</option>
                        <option value="No">No ‚ùå</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ROI Score</label>
                    <input type="number" id="edit-partner-roi" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label>Duration (days)</label>
                    <input type="number" id="edit-partner-duration" placeholder="9999" min="0" step="1">
                    <p style="font-size: 11px; color: #666; margin-top: 4px;">How many days the partnership is valid</p>
                </div>
                <button onclick="updatePartner()" style="font-size: 16px; padding: 14px 28px;">üíæ Save Changes</button>
                <button onclick="hideEditPartnerForm()"
                    style="background: linear-gradient(135deg, #64748b 0%, #475569 100%); margin-left: 10px; font-size: 16px; padding: 14px 28px;">‚ùå
                    Cancel</button>
            </div>

            <div style="margin-bottom: 20px;">
                <button onclick="showDeletedPartners()"
                    style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); font-size: 16px; padding: 14px 28px;">üóëÔ∏è
                    Show Deleted Partners</button>
            </div>

            <div
                style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; border: 2px solid #bae6fd;">
                <label style="display: flex; align-items: center; cursor: pointer; font-weight: 500; color: #0c4a6e;">
                    <input type="checkbox" id="show-inactive-partners" onchange="loadPartners()"
                        style="margin-right: 10px; width: 20px; height: 20px; cursor: pointer; accent-color: #667eea;">
                    <span>üëÅÔ∏è Show inactive partners</span>
                </label>
            </div>
            <table id="partners-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Referral Link</th>
                        <th>Commission</th>
                        <th>Active</th>
                        <th>Verified</th>
                        <th>Duration (days)</th>
                        <th style="cursor: pointer;" onclick="sortPartnersByROI()" title="Click to sort by ROI Score">
                            ROI <span id="roi-sort-icon">‚¨á</span></th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="partners-tbody"></tbody>
            </table>

            <!-- Deleted Partners Modal -->
            <div id="deleted-partners-modal"
                style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow: auto;">
                <div
                    style="background: white; margin: 50px auto; max-width: 900px; padding: 30px; border-radius: 12px;">
                    <h2 style="margin-bottom: 20px;">üóëÔ∏è Deleted Partners History</h2>
                    <table id="deleted-partners-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Deleted At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="deleted-partners-tbody"></tbody>
                    </table>
                    <button onclick="hideDeletedPartners()" style="background: #666; margin-top: 20px;">Close</button>
                </div>
            </div>
        </div>

        <!-- Database Tab -->
        <div id="database" class="tab-content">
            <h2>üóÑÔ∏è Database Viewer</h2>
            <div id="database-message"></div>

            <!-- Selected Bot Info removed (in global header) -->

            <!-- Users & Messages Combined Tab Content -->
            <div id="database-users-tab" class="database-tab-content active">
                <!-- Edit User Form -->
                <div id="edit-user-form"
                    style="display: none; background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #2563eb;">
                    <h3>Edit User</h3>
                    <input type="hidden" id="edit-user-id">
                    <div class="form-group">
                        <label>TOP Status</label>
                        <select id="edit-user-top-status">
                            <option value="locked">Locked</option>
                            <option value="open">Open</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>TOP Unlock Method</label>
                        <select id="edit-user-top-unlock-method">
                            <option value="">Not set</option>
                            <option value="payment">Payment (1‚≠ê)</option>
                            <option value="invites">Invites (5 friends)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Total Invited</label>
                        <input type="number" id="edit-user-total-invited" min="0" step="1">
                    </div>
                    <div class="form-group">
                        <label>Wallet Address</label>
                        <input type="text" id="edit-user-wallet-address" placeholder="TON wallet address">
                    </div>
                    <div class="form-group">
                        <label>Balance</label>
                        <input type="number" id="edit-user-balance" min="0" step="0.01">
                    </div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                        <h4 style="margin: 0 0 10px 0; color: #ef4444;">‚ö†Ô∏è Testing Tools</h4>
                        <button onclick="resetInvites()"
                            style="background: #f59e0b; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; margin-right: 10px;">Reset
                            Invites to 0</button>
                        <button onclick="test5Invites()"
                            style="background: #10b981; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">Test
                            5 Invites</button>
                        <small style="display: block; margin-top: 8px; color: #6b7280;">Use these tools to test invite
                            functionality</small>
                    </div>
                    <button onclick="updateUser()"
                        style="background: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; margin-top: 15px;">Save
                        Changes</button>
                    <button onclick="hideEditUserForm()"
                        style="background: #666; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin-left: 10px;">Cancel</button>
                </div>

                <div
                    style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 10px;">
                    <div
                        style="padding: 15px; background: #f9fafb; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <label style="font-weight: 600; color: #374151; font-size: 12px;">Sort by:</label>
                        <select id="messages-sort-by" onchange="loadMessages(0, true)"
                            style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; background: white; cursor: pointer;">
                            <option value="timestamp" selected>Timestamp (recent first)</option>
                            <option value="response_time">Response Time (slowest first)</option>
                        </select>
                        <label style="font-weight: 600; color: #374151; margin-left: 20px; font-size: 12px;">Filter by
                            command:</label>
                        <select id="messages-command-filter" onchange="loadMessages(0, true)"
                            style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; background: white; cursor: pointer; min-width: 150px;">
                            <option value="">All commands</option>
                            <option value="/start">/start</option>
                            <option value="/top">/top</option>
                            <option value="/partners">/partners</option>
                            <option value="/wallet">/wallet</option>
                            <option value="/earnings">/earnings</option>
                            <option value="/share">/share</option>
                            <option value="/info">/info</option>
                        </select>
                        <label style="font-weight: 600; color: #374151; margin-left: 20px; font-size: 12px;">Filter by
                            user:</label>
                        <select id="messages-user-filter" onchange="loadMessages(0, true)"
                            style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; background: white; cursor: pointer; min-width: 200px;">
                            <option value="">All users</option>
                        </select>
                    </div>
                </div>
                <div
                    style="background: white; border-radius: 8px; overflow-x: auto; overflow-y: visible; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="min-width: 900px;">
                        <table
                            style="width: 100%; border-collapse: collapse; font-size: 10px; min-width: 900px; table-layout: fixed;">
                            <colgroup>
                                <col style="width: 50px;"> <!-- DateTime -->
                                <col style="width: 60px;"> <!-- UserID -->
                                <col style="width: 60px;"> <!-- ExtID -->
                                <col style="width: 80px;"> <!-- Username -->
                                <col style="width: 40px;"> <!-- Device -->
                                <col style="width: 25px;"> <!-- Lang -->
                                <col style="width: 70px;"> <!-- Wallet -->
                                <col style="width: 30px;"> <!-- Invited -->
                                <col style="width: 40px;"> <!-- TOP -->
                                <col style="width: 40px;"> <!-- Balance -->
                                <col style="width: 30px;"> <!-- Active -->
                                <col style="width: 45px;"> <!-- Created -->
                                <col style="width: 45px;"> <!-- Last Activity -->
                                <col style="width: 80px;"> <!-- Command -->
                                <col style="width: 50px;"> <!-- Source -->
                                <col style="width: 80px;"> <!-- Response -->
                                <col style="width: 40px;"> <!-- Response Time -->
                                <col style="width: 60px;"> <!-- Actions -->
                            </colgroup>
                            <thead style="background: #f9fafb;">
                                <tr>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Date/Time</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        User ID</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Ext. ID</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Username</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Device</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Lang</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Wallet</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Invited</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        TOP</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Balance</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Active</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Created</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Last Act.</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Command</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Source</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Response</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600;">
                                        Time</th>
                                    <th
                                        style="padding: 2px 4px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 9px; white-space: nowrap; font-weight: 600; position: sticky; right: 0; background: #f9fafb; z-index: 10;">
                                        Actions</th>
                                </tr>
                            </thead>
                            <tbody id="database-messages-tbody">
                                <tr>
                                    <td colspan="17" style="padding: 20px; text-align: center; color: #6b7280;">Select a
                                        bot to view messages</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="database-messages-more"
                        style="padding: 10px; text-align: center; background: #f9fafb; border-top: 1px solid #e5e7eb; display: none;">
                        <button onclick="loadMoreMessages()"
                            style="background: #2563eb; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">Show
                            More (10 more)</button>
                        <button onclick="loadAllMessages()"
                            style="background: #059669; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Load
                            All</button>
                        <button onclick="exportMessagesToCSV()"
                            style="background: #7c3aed; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">üìä
                            Export CSV</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Config Tab -->
        <div id="ai" class="tab-content">
            <h2>AI Configuration</h2>
            <div id="ai-message"></div>

            <!-- Bot selector removed (use global header) -->

            <div id="ai-config-form" style="background: #f9fafb; padding: 20px; border-radius: 8px;">
                <div class="form-group">
                    <label>Provider</label>
                    <select id="ai-provider">
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Model</label>
                    <input type="text" id="ai-model" placeholder="gpt-4o-mini">
                </div>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="password" id="ai-api-key" placeholder="sk-...">
                </div>
                <div class="form-group">
                    <label>Temperature</label>
                    <input type="number" id="ai-temperature" step="0.1" min="0" max="2" value="0.7">
                </div>
                <div class="form-group">
                    <label>System Prompt</label>
                    <textarea id="ai-prompt" rows="5"></textarea>
                </div>
                <button onclick="saveAIConfig()">Save Configuration</button>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="stats" class="tab-content">
            <h2>Bot Statistics</h2>
            <div id="stats-message"></div>

            <!-- Date Filter for Stats -->
            <div
                style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #e5e7eb; display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <h4 style="margin: 0; color: #374151;">üìÖ Time Range:</h4>
                <div style="display: flex; gap: 10px;">
                    <button onclick="setDateRange('stats', 7)"
                        style="padding: 6px 12px; font-size: 13px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db;">7
                        Days</button>
                    <button onclick="setDateRange('stats', 30)"
                        style="padding: 6px 12px; font-size: 13px; background: #e0f2fe; color: #0284c7; border: 1px solid #bae6fd; font-weight: 500;">30
                        Days</button>
                    <button onclick="setDateRange('stats', 90)"
                        style="padding: 6px 12px; font-size: 13px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db;">90
                        Days</button>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-left: auto;">
                    <input type="date" id="stats-date-start"
                        style="padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <span>to</span>
                    <input type="date" id="stats-date-end"
                        style="padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <button onclick="applyCustomDateRange('stats')"
                        style="padding: 6px 12px; font-size: 13px; background: #4f46e5; color: white;">Apply
                        Custom</button>
                </div>
            </div>

            <div id="stats-content"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div class="card" style="text-align: center;">
                    <h3>Total Users</h3>
                    <p id="stats-users-total" style="font-size: 2em; font-weight: bold; color: #4f46e5;">-</p>
                </div>
                <div class="card" style="text-align: center;">
                    <h3>Active Users</h3>
                    <p id="stats-users-active" style="font-size: 2em; font-weight: bold; color: #10b981;">-</p>
                </div>
                <div class="card" style="text-align: center;">
                    <h3>Total Partners</h3>
                    <p id="stats-partners-total" style="font-size: 2em; font-weight: bold; color: #f59e0b;">-</p>
                </div>
                <div class="card" style="text-align: center;">
                    <h3>Active Partners</h3>
                    <p id="stats-partners-active" style="font-size: 2em; font-weight: bold; color: #ef4444;">-</p>
                </div>
            </div>

            <!-- Mini App Analytics Section -->
            <h2 style="margin-top: 40px;">üì± Mini App Analytics (30 days)</h2>
            <div id="mini-app-stats-content"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                <div class="card" style="text-align: center;">
                    <h3>üìä Total Events</h3>
                    <p id="stats-ma-events" style="font-size: 2em; font-weight: bold; color: #6366f1;">-</p>
                </div>
                <div class="card" style="text-align: center;">
                    <h3>üë• Unique Sessions</h3>
                    <p id="stats-ma-sessions" style="font-size: 2em; font-weight: bold; color: #8b5cf6;">-</p>
                </div>
                <div class="card" style="text-align: center;">
                    <h3>üí∞ Wallet Connections</h3>
                    <p id="stats-ma-wallets" style="font-size: 2em; font-weight: bold; color: #22c55e;">-</p>
                </div>
                <div class="card" style="text-align: center;">
                    <h3>üì§ Share Events</h3>
                    <p id="stats-ma-shares" style="font-size: 2em; font-weight: bold; color: #0ea5e9;">-</p>
                </div>
            </div>

            <!-- Funnel Section -->
            <div class="card" style="margin-top: 20px;">
                <h3>üìä Mini App Funnel</h3>
                <div id="stats-funnel"
                    style="display: flex; align-items: center; justify-content: space-around; padding: 20px; gap: 10px;">
                    <div style="text-align: center; flex: 1;">
                        <div style="font-size: 2em; font-weight: bold; color: #6366f1;" id="funnel-home">0</div>
                        <div style="color: #6b7280; font-size: 12px;">üè† Home Views</div>
                    </div>
                    <div style="color: #9ca3af; font-size: 24px;">‚Üí</div>
                    <div style="text-align: center; flex: 1;">
                        <div style="font-size: 2em; font-weight: bold; color: #8b5cf6;" id="funnel-partners">0</div>
                        <div style="color: #6b7280; font-size: 12px;">üë• Partners Views</div>
                        <div style="color: #10b981; font-size: 11px;" id="funnel-rate1">0%</div>
                    </div>
                    <div style="color: #9ca3af; font-size: 24px;">‚Üí</div>
                    <div style="text-align: center; flex: 1;">
                        <div style="font-size: 2em; font-weight: bold; color: #ec4899;" id="funnel-clicks">0</div>
                        <div style="color: #6b7280; font-size: 12px;">üîó Partner Clicks</div>
                        <div style="color: #10b981; font-size: 11px;" id="funnel-rate2">0%</div>
                    </div>
                </div>
            </div>

            <!-- Top Partners Section -->
            <div class="card" style="margin-top: 20px;">
                <h3>üèÜ Top Partners by Clicks (Mini App)</h3>
                <div id="stats-top-partners" style="margin-top: 15px;">
                    <div style="color: #6b7280; font-style: italic;">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Monitoring Tab (Product Focused) -->
        <div id="monitoring" class="tab-content">
            <!-- Date Filter for Monitoring -->
            <div
                style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #e5e7eb; display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <h4 style="margin: 0; color: #374151;">üìÖ Time Range:</h4>
                <div style="display: flex; gap: 10px;">
                    <button onclick="setDateRange('monitoring', 7)"
                        style="padding: 6px 12px; font-size: 13px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db;">7
                        Days</button>
                    <button onclick="setDateRange('monitoring', 30)"
                        style="padding: 6px 12px; font-size: 13px; background: #e0f2fe; color: #0284c7; border: 1px solid #bae6fd; font-weight: 500;">30
                        Days</button>
                    <button onclick="setDateRange('monitoring', 90)"
                        style="padding: 6px 12px; font-size: 13px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db;">90
                        Days</button>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-left: auto;">
                    <input type="date" id="monitoring-date-start"
                        style="padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <span>to</span>
                    <input type="date" id="monitoring-date-end"
                        style="padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <button onclick="applyCustomDateRange('monitoring')"
                        style="padding: 6px 12px; font-size: 13px; background: #4f46e5; color: white;">Apply
                        Custom</button>
                </div>
            </div>

            <div id="monitoring-content">
                <div style="padding: 40px; text-align: center; color: #9ca3af;">
                    <p>Select a bot to view product monitoring data</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Admin JS Modules -->
    <script src="/static/js/admin/core.js"></script>
    <script src="/static/js/admin/bots.js"></script>
    <script src="/static/js/admin/partners.js"></script>
    <script src="/static/js/admin/database.js"></script>
    <script src="/static/js/admin/extra.js"></script>
    <script src="/static/js/admin/monitoring.js"></script>
</body>

</html>