<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2481cc">
    <title>Mini App</title>

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- TON Connect SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

    <!-- Compliance Checker (for debugging - can be removed in production) -->
    <script src="/static/mini-app/js/compliance-checker.js" defer></script>

    <!-- Styles -->
    <link rel="stylesheet" href="/static/mini-app/css/styles.css?v=5.3">
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="spinner"></div>
        <p id="loading-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
    </div>

    <!-- Onboarding Screens (shown on first visit) -->
    <div id="onboarding-screen" class="onboarding-screen" style="display: none;">
        <!-- Screen 1 -->
        <div id="onboarding-screen-1" class="onboarding-content active">
            <div class="onboarding-illustration">üöÄ</div>
            <h1 id="onboarding-title-1">–¢—É—Ç –∑–∞—Ä–æ–±–ª—è—é—Ç—å –Ω–∞ –¥—ñ—ó —É Telegram</h1>
            <div class="onboarding-progress">
                <span class="progress-dot active">‚óè</span>
                <span class="progress-dot">‚óã</span>
            </div>
            <button id="onboarding-next-btn" class="onboarding-btn primary-action-btn">‚ñ∂Ô∏è <span
                    id="onboarding-next-text">–î–∞–ª—ñ</span></button>
        </div>

        <!-- Screen 2 -->
        <div id="onboarding-screen-2" class="onboarding-content">
            <div class="onboarding-steps">
                <div class="onboarding-step">
                    <span class="step-number">1Ô∏è‚É£</span>
                    <p id="onboarding-step-1-text">–ê–∫—Ç–∏–≤—É–π 7%</p>
                </div>
                <div class="onboarding-step">
                    <span class="step-number">2Ô∏è‚É£</span>
                    <p id="onboarding-step-2-text">–ü–æ–¥—ñ–ª–∏—Å—å –ª—ñ–Ω–∫–æ—é</p>
                </div>
                <div class="onboarding-step">
                    <span class="step-number">3Ô∏è‚É£</span>
                    <p id="onboarding-step-3-text">–õ—é–¥–∏ –∫—É–ø—É—é—Ç—å ‚Üí —Ç–∏ –æ—Ç—Ä–∏–º—É—î—à %</p>
                </div>
            </div>
            <div class="onboarding-progress">
                <span class="progress-dot">‚óã</span>
                <span class="progress-dot active">‚óè</span>
            </div>
            <button id="onboarding-start-btn" class="onboarding-btn primary-action-btn">‚ñ∂Ô∏è <span
                    id="onboarding-start-text">–ü–æ—á–∞—Ç–∏</span></button>
        </div>
    </div>

    <!-- Wallet Modal (TON Connect Style) -->
    <div id="wallet-modal" class="wallet-connect-modal" style="display: none;">
        <div class="wallet-connect-content">
            <!-- Header -->
            <div class="wallet-connect-header">
                <button class="wallet-connect-close" id="wallet-modal-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
            </div>

            <!-- Title -->
            <h2 class="wallet-connect-title">Connect your TON wallet</h2>
            <p class="wallet-connect-subtitle">Use Wallet in Telegram or choose other application</p>

            <!-- Primary: Connect Wallet in Telegram -->
            <button id="wallet-connect-telegram" class="wallet-connect-primary-btn">
                <span class="wallet-btn-icon">üíé</span>
                <span>Connect Wallet in Telegram</span>
                <span class="wallet-btn-icon">‚úàÔ∏è</span>
            </button>

            <!-- Separator -->
            <div class="wallet-connect-separator">
                <span>Choose other application</span>
            </div>

            <!-- Wallet Options Grid -->
            <div class="wallet-options-grid">
                <button class="wallet-option" data-wallet="tonkeeper">
                    <div class="wallet-option-icon tonkeeper-icon">üíé</div>
                    <span>Tonkeeper</span>
                </button>
                <button class="wallet-option" data-wallet="mytonwallet">
                    <div class="wallet-option-icon mytonwallet-icon">üî∑</div>
                    <span>MyTonWallet</span>
                </button>
                <button class="wallet-option" data-wallet="tonhub">
                    <div class="wallet-option-icon tonhub-icon">üîÆ</div>
                    <span>Tonhub</span>
                </button>
                <button class="wallet-option" data-wallet="view-all">
                    <div class="wallet-option-icon view-all-icon">‚ûï</div>
                    <span>View all wallets</span>
                </button>
            </div>

            <!-- Footer -->
            <div class="wallet-connect-footer">
                <div class="ton-connect-badge">
                    <span class="ton-connect-icon">üíé</span>
                    <span>TON Connect</span>
                </div>
                <button class="wallet-help-btn" aria-label="–î–æ–ø–æ–º–æ–≥–∞">?</button>
            </div>
        </div>
    </div>

    <!-- Fallback: Manual Input Modal (if TON Connect not available) -->
    <div id="wallet-manual-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content wallet-modal-content">
            <h2 id="wallet-manual-title">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ TON –≥–∞–º–∞–Ω–µ—Ü—å</h2>
            <p class="wallet-modal-copy" id="wallet-modal-copy">–ü–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ –¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö –≤–∏–ø–ª–∞—Ç<br>–ù—ñ–∫–æ–ª–∏ –Ω–µ —Å–ø–∏—Å—É—î–º–æ
                –∫–æ—à—Ç–∏</p>
            <div class="wallet-instructions">
                <p class="wallet-instructions-title" id="wallet-instructions-title">–Ø–∫ –∑–Ω–∞–π—Ç–∏ –∞–¥—Ä–µ—Å—É –≥–∞–º–∞–Ω—Ü—è:</p>
                <ul class="wallet-instructions-list">
                    <li id="wallet-instruction-1">–í—ñ–¥–∫—Ä–∏–π —Å–≤—ñ–π TON –≥–∞–º–∞–Ω–µ—Ü—å (Tonkeeper, MyTonWallet, Tonhub)</li>
                    <li id="wallet-instruction-2">–ó–Ω–∞–π–¥–∏ —Ä–æ–∑–¥—ñ–ª "Receive" –∞–±–æ "–û—Ç—Ä–∏–º–∞—Ç–∏"</li>
                    <li id="wallet-instruction-3">–°–∫–æ–ø—ñ—é–π –∞–¥—Ä–µ—Å—É (–ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ EQ, UQ, kQ –∞–±–æ 0Q)</li>
                </ul>
            </div>
            <form id="wallet-manual-form-el" class="wallet-form">
                <label for="wallet-modal-input" class="wallet-input-label" id="wallet-modal-input-label">–ê–¥—Ä–µ—Å–∞ TON
                    –≥–∞–º–∞–Ω—Ü—è:</label>
                <input type="text" id="wallet-modal-input" class="wallet-input"
                    placeholder="EQD0X... –∞–±–æ UQD0X... (48 —Å–∏–º–≤–æ–ª—ñ–≤)" pattern="^(?:EQ|UQ|kQ|0Q)[A-Za-z0-9_-]{46,48}$"
                    required aria-describedby="wallet-input-hint">
                <p id="wallet-input-hint" class="wallet-input-hint">–ü—Ä–∏–∫–ª–∞–¥: EQD0X... –∞–±–æ UQD0X...</p>
                <div class="wallet-form-actions">
                    <button type="submit" class="primary-action-btn" id="wallet-manual-save-btn">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                    <button type="button" id="wallet-manual-close" class="secondary-action-btn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Share Auto-popup -->
    <div id="share-popup" class="share-popup" style="display: none;">
        <div class="share-popup-content">
            <h3 id="share-popup-title">–ü–æ–¥—ñ–ª–∏—Å—è –ª—ñ–Ω–∫–æ—é</h3>
            <p id="share-popup-text">–Ø –ø—ñ–¥ º—î–¥–Ω–∞–≤—Å—è –¥–æ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—å–∫–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏ Telegram. –¶–µ –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</p>
            <div class="share-popup-actions">
                <button id="share-popup-share-btn" class="primary-action-btn">‚ñ∂Ô∏è <span
                        id="share-popup-share-text">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</span></button>
                <button id="share-popup-close-btn" class="secondary-action-btn">‚úï <span
                        id="share-popup-close-text">–ó–∞–∫—Ä–∏—Ç–∏</span></button>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until ready) -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header" role="banner">
            <h1 id="bot-name">Mini App</h1>
            <button id="close-btn" class="close-btn" aria-label="–ó–∞–∫—Ä–∏—Ç–∏ Mini App" type="button">√ó</button>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs" role="navigation" aria-label="–ì–æ–ª–æ–≤–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è">
            <button class="tab active" data-tab="home" aria-label="–ì–æ–ª–æ–≤–Ω–∞" aria-current="page">
                <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg>
                <span class="tab-label">–ì–æ–ª–æ–≤–Ω–∞</span>
            </button>
            <button class="tab" data-tab="partners" aria-label="–ü–∞—Ä—Ç–Ω–µ—Ä–∏">
                <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor">
                    <path
                        d="M16.5 12.25c1.52 0 2.75-1.23 2.75-2.75S18.02 6.75 16.5 6.75s-2.75 1.23-2.75 2.75 1.23 2.75 2.75 2.75ZM7.5 12.25c1.52 0 2.75-1.23 2.75-2.75S9.02 6.75 7.5 6.75 4.75 7.98 4.75 9.5s1.23 2.75 2.75 2.75Zm9 1.5c-2.1 0-6.25 1.05-6.25 3.15V19h12.5v-2.1c0-2.1-4.15-3.15-6.25-3.15Zm-9 0C5.4 13.75 1.25 14.8 1.25 16.9V19h7.5v-2.1c0-.86.37-1.6.98-2.22-.66-.5-1.58-.93-2.23-.93Z" />
                </svg>
                <span class="tab-label">–ü–∞—Ä—Ç–Ω–µ—Ä–∏</span>
            </button>
            <button class="tab" data-tab="top" aria-label="TOP –ø–∞—Ä—Ç–Ω–µ—Ä–∏">
                <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor">
                    <path
                        d="M12 2l2.85 6.63L22 9.24l-5.4 4.68L18.2 21 12 17.27 5.8 21l1.6-7.08L2 9.24l7.15-.61L12 2z" />
                </svg>
                <span class="tab-label">TOP</span>
            </button>
        </nav>

        <!-- Pull-to-refresh indicator - DISABLED -->
        <!-- <div id="pull-to-refresh" class="pull-to-refresh">
            <div class="pull-to-refresh-icon">‚¨áÔ∏è</div>
            <div class="pull-to-refresh-text">–ü–æ—Ç—è–≥–Ω—ñ—Ç—å –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</div>
        </div> -->

        <!-- Content Areas -->
        <main class="content" role="main">
            <!-- HOME Page (Action Engine) -->
            <section id="home-page" class="page active">
                <!-- Trust Header (Static) -->
                <div class="trust-header" id="trust-header">
                    <div class="trust-item" id="trust-item-1">üü¢ Official Telegram Partner Program</div>
                    <div class="trust-item" id="trust-item-2">üü¢ Revenue share model (–¥–æ 7%)</div>
                    <div class="trust-item" id="trust-item-3">üü¢ Wallet: optional</div>
                </div>

                <!-- Primary Action Card -->
                <div class="primary-action-card" id="primary-action-card">
                    <!-- Will be rendered dynamically -->
                </div>

                <!-- Share Strip (Always Visible) -->
                <div class="share-strip" id="share-strip">
                    <div class="share-copy" id="share-copy">
                        <p id="share-copy-1">–¢–≤–æ—è –ª—ñ–Ω–∫–∞ –ø—Ä–∞—Ü—é—î 24/7</p>
                        <p id="share-copy-2">–ö–æ–∂–µ–Ω –Ω–æ–≤–∏–π —é–∑–µ—Ä –º–æ–∂–µ –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Ü–µ–π —à–ª—è—Ö –¥–∞–ª—ñ</p>
                    </div>
                    <button class="share-btn" id="share-btn" aria-label="–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è">‚ñ∂Ô∏è <span
                            id="share-btn-text">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</span></button>
                </div>

                <!-- Wallet Banner (Contextual, shown if not connected) -->
                <div class="wallet-banner" id="wallet-banner" style="display: none;">
                    <div class="wallet-banner-content">
                        <p id="wallet-banner-text">–ü—ñ–¥–∫–ª—é—á–∏ –≥–∞–º–∞–Ω–µ—Ü—å ‚Üí –∑–º–æ–∂–µ—à –≤–∏–≤–æ–¥–∏—Ç–∏</p>
                        <button class="wallet-banner-btn" id="wallet-banner-btn">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏</button>
                    </div>
                </div>

                <!-- Social Proof (Event-Based) -->
                <div class="social-proof" id="social-proof">
                    <!-- Will be rendered dynamically -->
                </div>

                <!-- Gamification (Status, Badges, Progress) -->
                <div class="gamification" id="gamification">
                    <!-- Will be rendered dynamically -->
                </div>

                <!-- Info Section (Integrated /info command) -->
                <div class="info-section" id="info-section">
                    <button class="info-collapse-btn" id="info-collapse-btn">
                        <span>‚ÑπÔ∏è <span id="info-title-text">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –±–æ—Ç</span></span>
                        <span class="collapse-icon">‚ñº</span>
                    </button>
                    <div class="info-content" id="info-content" style="display: none;">
                        <!-- Will be rendered dynamically from translations -->
                    </div>
                </div>

                <!-- Loading Skeleton -->
                <div id="home-skeleton" class="skeleton-home" style="display: none;">
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                </div>
            </section>

            <!-- Partners Page -->
            <section id="partners-page" class="page">
                <!-- Search & Filters (shown only when expanded) -->
                <div class="page-header" id="partners-page-header" style="display: none;">
                    <div class="search-box">
                        <input type="text" id="partner-search" class="search-input" placeholder="üîç –ü–æ—à—É–∫ –ø–∞—Ä—Ç–Ω–µ—Ä—ñ–≤...">
                        <button class="filter-btn" id="filter-btn" aria-label="–§—ñ–ª—å—Ç—Ä–∏">‚öôÔ∏è</button>
                    </div>
                    <div class="filter-panel" id="filter-panel" style="display: none;">
                        <div class="filter-group">
                            <label id="sort-label">–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:</label>
                            <select id="sort-select" class="filter-select">
                                <option value="name" id="sort-name">–ó–∞ –Ω–∞–∑–≤–æ—é</option>
                                <option value="commission" id="sort-commission">–ó–∞ –∫–æ–º—ñ—Å—ñ—î—é</option>
                                <option value="new" id="sort-new">–°–ø–æ—á–∞—Ç–∫—É –Ω–æ–≤—ñ</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label id="category-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</label>
                            <div class="filter-chips">
                                <button class="chip active" data-filter="all" id="filter-all">–í—Å—ñ</button>
                                <button class="chip" data-filter="new" id="filter-new">NEW</button>
                                <button class="chip" data-filter="top" id="filter-top">TOP</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Partners List Container -->
                <div id="partners-list">
                    <!-- Partners will be loaded here -->
                </div>

                <!-- Loading Skeleton -->
                <div id="partners-skeleton" class="skeleton-grid" style="display: none;">
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                </div>
            </section>

            <!-- TOP Page -->
            <section id="top-page" class="page">
                <div id="top-list">
                    <!-- TOP partners or locked message -->
                </div>
                <!-- Loading Skeleton -->
                <div id="top-skeleton" class="skeleton-grid" style="display: none;">
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                </div>
            </section>


            <!-- Partner Detail Page (hidden by default) -->
            <section id="partner-detail-page" class="page">
                <div class="detail-header">
                    <button class="back-btn" onclick="goBack()" id="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2 id="partner-detail-name"></h2>
                </div>
                <div class="partner-detail-content" id="partner-detail-content">
                    <!-- Partner details will be loaded here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator" style="display: none;">
        <span class="offline-icon">üì°</span>
        <span class="offline-text">–ù–µ–º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑'—î–¥–Ω–∞–Ω–Ω—è</span>
    </div>

    <!-- Error Message (hidden by default) -->
    <div id="error-message" class="error-message" style="display: none;">
        <p id="error-text"></p>
        <button id="retry-btn" class="retry-btn">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑</button>
    </div>

    <!-- Scripts (load synchronously to maintain order) -->
    <script src="/static/mini-app/js/utils.js?v=3.1"></script>
    <script src="/static/mini-app/js/api.js?v=3.1"></script>
    <script src="/static/mini-app/js/state.js?v=3.1"></script>
    <script src="/static/mini-app/js/tonconnect.js?v=3.1"></script>

    <!-- Core Render Logic (Must load before extending modules) -->
    <script src="/static/mini-app/js/render.js?v=5.0"></script>

    <!-- v5.0 Modules -->
    <script src="/static/mini-app/js/utils/Icons.js?v=5.0"></script>
    <script src="/static/mini-app/js/components/SharePopup.js?v=5.0"></script>
    <script src="/static/mini-app/js/components/Wallet.js?v=5.0"></script>
    <script src="/static/mini-app/js/components/Gamification.js?v=5.0"></script>
    <script src="/static/mini-app/js/pages/Partners.js?v=5.0"></script>
    <script src="/static/mini-app/js/pages/Top.js?v=5.0"></script>

    <script src="/static/mini-app/js/components/Header.js?v=5.0"></script>
    <script src="/static/mini-app/js/components/Hero.js?v=5.0"></script>
    <script src="/static/mini-app/js/components/NavCards.js?v=5.0"></script>
    <script src="/static/mini-app/js/components/MoneyMath.js?v=5.0"></script>
    <script src="/static/mini-app/js/components/Footer.js?v=5.0"></script>

    <!-- Legal extends Render, must load after render.js -->
    <script src="/static/mini-app/js/pages/Legal.js?v=5.0"></script>
    <script src="/static/mini-app/js/pages/Home.js?v=5.0"></script>

    <!-- Core App Logic -->
    <script src="/static/mini-app/js/navigation.js?v=3.1"></script>
    <script src="/static/mini-app/js/actions.js?v=3.1"></script>
    <script src="/static/mini-app/js/events.js?v=3.1"></script>
    <script src="/static/mini-app/js/app.js?v=3.1"></script>
    <script>
        // Ensure AppState is loaded before initialization
        (function () {
            if (typeof AppState === 'undefined') {
                console.error('AppState failed to load!');
                const errorEl = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                const loading = document.getElementById('loading');
                if (errorEl && errorText) {
                    errorText.textContent = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É.';
                    errorEl.style.display = 'block';
                    if (loading) loading.style.display = 'none';
                }
            }
        })();
    </script>
</body>

</html>